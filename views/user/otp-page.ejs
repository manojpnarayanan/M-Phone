<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OTP Verification</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body {
            background: linear-gradient(135deg, #667eea, #764ba2);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .card {
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        .btn-brand {
            background: #764ba2;
            color: #fff;
        }
        .btn-brand:hover {
            background: #5a3e80;
        }
        .btn-secondary {
            background-color: #6c757d;
            color: #fff;
        }
        .btn-secondary:hover {
            background-color: #5a6268;
        }
        .timer {
            font-size: 1.2rem;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="card p-4">
                    <div class="card-header text-center bg-white">
                        <h4>Enter OTP</h4>
                    </div>
                    <div class="card-body">
                        <form id="otpForm" action="/user/login" method="POST">
                            <div class="mb-3">
                                <label for="otp" class="form-label">OTP</label>
                                <input type="text" class="form-control" id="otp" name="otp" required>
                            </div>
                            <div class="mb-3">
                                <button type="submit" class="btn btn-brand w-100" id="verifyButton">Verify OTP</button>
                            </div>
                            <div class="mb-3">
                                <span id="timer" class="timer">01:00</span>
                            </div>
                            <div class="mb-3">
                                <button type="button" class="btn btn-secondary w-100" id="resendOtpButton" disabled>Resend OTP</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- <script>
        
document.addEventListener("DOMContentLoaded", function () {
    // Timer setup
    let timeLeft = 60; // 1-minute timer
    const timerElement = document.getElementById("timer");
    const resendOtpButton = document.getElementById("resendOtpButton");
    const verifyButton = document.getElementById("verifyButton");
    const otpInput = document.getElementById("otp");

    function startTimer() {
        timeLeft = 60;
        resendOtpButton.disabled = true;
        otpInput.disabled = false;
        verifyButton.disabled = false;

        const countdown = setInterval(() => {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            timerElement.textContent = `${minutes < 10 ? "0" : ""}${minutes}:${seconds < 10 ? "0" : ""}${seconds}`;
            timeLeft--;

            if (timeLeft < 0) {
                clearInterval(countdown);
                timerElement.textContent = "00:00";
                resendOtpButton.disabled = false;
                otpInput.disabled = true;
                verifyButton.disabled = true;
            }
        }, 1000);
    }

    startTimer(); // Start the timer when the page loads

    // Resend OTP Button functionality
    resendOtpButton.addEventListener("click", async function () {
        const email = localStorage.getItem("userEmail"); // Store the email when signing up
        
        if (!email) {
        alert("Email is missing. Please sign up again.");
        return;
    }
        try {
            const response = await fetch("/user/resend-otp", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ email }),
            });

            const data = await response.json();
            console.log(data)
            if (data.otpToken) {
                localStorage.setItem("otpToken", data.otpToken); // Store new OTP token
                alert("OTP has been resent!");
                startTimer(); // Restart the countdown
            } else {
                alert(data.message);
            }
        } catch (error) {
            console.error("Error:", error);
            alert("Something went wrong. Please try again.");
        }
    });

    // OTP Form Submission
    document.getElementById("otpForm").addEventListener("submit", async function (event) {
        event.preventDefault(); // Prevent default form submission

        const otp = otpInput.value;
        const otpToken = localStorage.getItem("otpToken");

        if (!otpToken) {
            alert("OTP token is missing. Please sign up again.");
            return;
        }

        try {
            // Send OTP validation request to backend
            const response = await fetch("/user/otp/validate", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ otp, otpToken }),
            });

            const data = await response.json();
            console.log("Server Response:", data);

            if (data.redirect) {
                alert("OTP verified! Redirecting...");
                localStorage.removeItem("otpToken"); // Clear OTP token after success
                window.location.href = data.redirect; // Redirect to the dashboard or login page
            } else {
                alert(data.message); // Show error message from backend
            }
        } catch (error) {
            console.error("Error:", error);
            alert("Something went wrong. Please try again.");
        }
    });
});


    </script> -->
</body>
</html>